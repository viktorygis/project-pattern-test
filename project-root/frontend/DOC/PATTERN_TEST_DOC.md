# Документация по тесту на паттерны поведения

## Оглавление
1. [Требования к окружению и запуску](#требования-к-окружению-и-запуску)
2. [Общее описание](#общее-описание)
3. [Варианты прохождения теста](#варианты-прохождения-теста)
    - [Вариант 1: Прохождение теста на сайте](#вариант-1-прохождение-теста-на-сайте)
    - [Вариант 2: Прохождение теста через Telegram-бота](#вариант-2-прохождение-теста-через-telegram-бота)
4. [Результаты](#Результаты)
    - [Структура и интерфейс результатов](#структура-и-интерфейс-результатов)
    - [Логика расчёта результатов](#логика-расчёта-результатов)
5. [Данные и форматы](#данные-и-форматы)
7. [Требования к стилям и кастомизации](#требования-к-стилям-и-кастомизации)
8. [Генерация PDF-отчёта](#генерация-pdf-отчёта)
9. [Расширяемость и поддержка](#расширяемость-и-поддержка)

---
---

## Требования к окружению и запуску

- Node.js 18+
- React 18+
- Установка: `npm install`
- Запуск разработки: `npm start`
- Сборка: `npm run build`
- Статичные данные (JSON, изображения) размещаются в `public/data` и `public/img`
- `node server.js` - запуск тестового сервера по адресу http://localhost:5000
---

## Общее описание

Тест на паттерны поведения — интерактивный инструмент для диагностики ключевых моделей реагирования, мышления, общения и поведения. Подходит для личного развития, самоанализа и повышения эффективности коммуникации.

---

## Варианты прохождения теста

### Вариант 1: Прохождение теста на сайте

- Пользователь проходит тест непосредственно на сайте.
- Последовательность экранов:
    1. **Введение** — описание целей теста с кнопкой "начать текст"
    2. **Ввод данных** — форма для ФИО, контактов, согласий.
    3. **Вопросы теста** — пошаговое прохождение с выбором вариантов.
    4. **Результаты теста** — визуализация и интерпретация результатов, возможность скачать PDF.
- Все ответы и результаты обрабатываются на клиенте.

### Вариант 2: Прохождение теста через Telegram-бота (`PatternsTest`)

- Пользователь проходит тест в Telegram-боте.
- Вопросы приходят в чат, ответы отправляются боту.
- После завершения теста бот отправляет ответы на сервер, где они сохраняются в базу данных.
- Сервер формирует индивидуальную ссылку для просмотра результатов (например, `https://site.ru/results/1234`).
- Пользователь открывает ссылку в браузере, где отображается подробный анализ, визуализация и можно скачать PDF-отчет

---


## Результаты
### Структура и интерфейс результатов

- **Блок 1:** Приветствие и рекомендации, кнопка "Скачать PDF".
- **Блок 2:** Результаты тестирования — гистограммы по категориям, явные паттерны, выделение ведущей категории.
- **Блок 3:** Интерпретация — ведущая категория, топ-паттерны, тип реагирования, модель поведения, сильные стороны и комментарий.
- **Блок 4:** Литература — рекомендованные источники.
- **Блок 5:** Подробное распределение паттернов по категориям и подкатегориям.

---

### Логика расчёта результатов

- Результаты рассчитываются по структуре категорий и подкатегорий паттернов (см. `patterns.json`).
- Для каждой подкатегории считается процент выраженности каждого паттерна:
  `Процент = (Число выборов паттерна / Общее число выборов в подкатегории) * 100`
- Явно проявленный паттерн — с выраженностью 75% и выше.
- Логика расчёта реализована в `utils/createResultsData.js`.

---



## Данные и форматы

- **questions.json** — массив вопросов, каждому варианту сопоставлен паттерн.
- **patterns.json** — структура категорий, подкатегорий и паттернов, описания, CSS-классы.
- **Ответы пользователя** (из бота или сайта) — массив выбранных паттернов (строк), сохраняется на сервере.
- Все данные в формате JSON, кодировка UTF-8.

---

## Требования к стилям и кастомизации

- Индивидуальные CSS-классы для категорий, подкатегорий и паттернов.
- Паттерны с максимальной выраженностью и категория-лидер выделяются отдельными стилями.
- Форма и кнопки стилизованы по макетам.

---

## Генерация PDF-отчёта

- PDF-отчет с результатами доступен для скачивания на странице результатов.
- Генерация реализована через `utils/pdfmakeGenerator.js`.

---

## Расширяемость и поддержка

- Для добавления новых вопросов, паттернов или категорий — редактируйте соответствующие JSON-файлы.
- Логика расчёта процентов — в `utils/createResultsData.js` и `PatternBarChart.jsx`.
- Приложение написано на React, поддерживает компонентный подход и легко расширяется.



## Дополнительная информация

- Проект поддерживает валидацию форм и обработку ошибок на каждом этапе.
- Порядок вопросов и вариантов всегда перемешивается для повышения валидности теста.
- Код покрыт комментариями, основные алгоритмы расчётов вынесены в отдельные модули.
- Ответы, полученные от Telegram-бота, автоматически попадают на сервер и обрабатываются для формирования результатов по индивидуальной ссылке.

---


# Пошаговый разбор работы приложения

---

## 1. Страницы и порядок работы приложения

### 1.1. **Главная страница (IntroScreen): `/`**
- Пользователь видит:
  - Вводные секции.
  - Описание теста.
  - Инструкции.
  - Кнопку «Начать тест».

---

### 1.2. **Страница тестирования (TestPage): `/test`**
Процесс тестирования разделён на несколько шагов:

#### Шаг 1: **FormScreen**
- Пользователь заполняет данные о себе (например, имя, возраст и т.д.).

#### Шаг 2: **QuestionsScreen**
- Проходится пошаговый тест.
- Пользователь отвечает на серии вопросов.
- На основе ответов собирается массив **`answers`**, в который сохраняются результаты теста.

#### Шаг 3: **ResultsScreen**
- После завершения теста отображаются результаты.
- Результаты формируются на основе массива **`answers`** и вычисления соответствий с *patternResults*.

---

### 1.3. **Страница результатов (ResultPage): `/results/:id`**

Эта страница используется для просмотра результатов по уникальной ссылке, а также в сценарии Telegram-бота. Пошаговый процесс:

1. Загружается JSON-файл **`patterns.json`**, содержащий категории, подкатегории и паттерны.
2. С сервера через API-запрос **`/api/results/:id`** загружаются ответы пользователя (массив `answers`).
   - Если происходит ошибка (например, ID не найден), подставляются тестовые данные.
3. На основе загруженных данных формируется массив **`patternResults`**, который представляет собой список выбранных пользователем паттернов (результаты теста).
4. Все собранные данные передаются в компонент **ResultsScreen**, где происходит финальное отображение.

---

### 1.4. **Компонент отображения результатов (ResultsScreen)**

- Загружает JSON-файл **`patterns.json`** (ещё один вызов JSON. Оптимизация возможна, но не обязательна для работы).
- Вызывает функцию **`createResultsData`**, передавая туда массив **`patternResults`** (массив строк, представляющих выбранные паттерны).
- Отображает итоговые данные:
  - Гистограммы.
  - Результаты по секциям.
  - Другие визуализации.

---

## 2. Рабочая логика для ответов (answers)

### Что такое **`answers`**?

- **`answers`** — это массив ответов, полученных от пользователя.
- В массиве должны быть строки, соответствующие *названиям паттернов* из `patterns.json` (**`pat.pattern.ru`** или **`pat.pattern.en`**).
  Например: "Дефицит времени" или "Изобилие времени".

### Почему это важно?

Функция расчёта результатов (**`createResultsData`**) сравнивает элементы массива ответов с названиями паттернов из `patterns.json`.
- Если названия из массива **`answers`** и из **`patterns.json`** не совпадают, результат будет равен 0%.
- Это приводит к пустым визуализациям на странице результатов.

---

## 3. Как работает на практике?

Рассмотрим пример вопроса из `questions.json`:

``json``
{
  "question": "Выберите из представленных слов то, которое больше нравится:",
  "options": ["Быстро", "Обдуманно"],
  "patterns": ["Дефицит времени", "Изобилие времени"]
}


# Установленные пакеты и их назначение

В проекте используются следующие пакеты, которые можно разделить на три логические группы: фреймворк и библиотеки для разработки, тестирование, а также инструментальные и стилизационные библиотеки.

---

## Логика приложения и основные библиотеки

- **`react` & `react-dom` (`^19.1.0`)**
  Основа приложения. `react` — библиотека для построения пользовательских интерфейсов; `react-dom` отвечает за рендеринг компонентов в DOM.

- **`react-router-dom` (`^7.6.3`)**
  Используется для управления маршрутизацией, позволяет переключаться между разными страницами (например, `/`, `/test`, `/results/:id`).

- **`react-scripts` (`5.0.1`)**
  Библиотека, предоставляемая `Create React App`, которая включает в себя конфигурации Webpack, Babel и утилиты для сборки, разработки и тестирования приложений React.

- **`pdfmake` (`^0.2.20`)**
  Позволяет динамически генерировать PDF-отчеты для пользователей в результате прохождения теста.

- **`imask` (`^7.6.1`)**
  Применяется для создания масок ввода при работе с формами (например, ввод телефона или даты).

- **`web-vitals` (`^2.1.4`)**
  Библиотека для сбора и анализа ключевых метрик производительности браузера (используется для оптимизации пользовательского опыта).

---

## Тестирование приложения

- **`@testing-library/dom` (`^10.4.0`)**
  Инструмент для тестирования логики вашей работы с элементами DOM. Он помогает писать надежные и реалистичные тесты на пользовательский интерфейс.

- **`@testing-library/react` (`^16.3.0`)**
  Конкретное тестовое окружение для React-компонентов. Позволяет тестировать, как компоненты взаимодействуют с данными и событиями.

- **`@testing-library/jest-dom` (`^6.6.3`)**
  Расширяет возможности Jest, добавляя специфические методы для тестирования DOM (например, `toHaveTextContent`, `toBeVisible`).

- **`@testing-library/user-event` (`^13.5.0`)**
  Используется для имитации пользовательских событий (например, кликов, ввода текста), что делает тесты более реалистичными.

---

## Стилизация и препроцессинг CSS

- **`sass` (`^1.89.2`)**
  Препроцессор CSS, который позволяет писать более гибкий, модульный и организованный стиль-код.

- **`sass-loader` (`^16.0.5`)**
  Вспомогательная библиотека для интеграции Sass в процесс сборки приложения через Webpack.

---

## Разделение задач между пакетами

- **Тестирование:**
  - `@testing-library/dom`
  - `@testing-library/react`
  - `@testing-library/jest-dom`
  - `@testing-library/user-event`

- **Разработка стилей:**
  - `sass`
  - `sass-loader`

- **Отчеты в PDF:**
  - `pdfmake`

- **Маски ввода:**
  - `imask`

- **Оптимизация производительности:**
  - `web-vitals`

---

## Установка зависимостей

Чтобы установить все перечисленные зависимости, выполните команду:
`bash`
npm install


## Кратко по шагам пользователя
  - Пользователь заходит на /pattern-test
  - Видит вводную, кнопку "Начать тест".
  - Нажимает "Начать тест"
  - Появляется форма (ФИО, контакт, согласие).
  - Заполняет форму — появляются вопросы
  - Вопросы идут пошагово.
  - Заполнил все вопросы — отправка на сервер
  - Сервер возвращает ID результата.
  - Показывается страница с результатом
  - Либо сразу редирект на /pattern-test/results/:id, либо на той же странице — ссылка "Посмотреть результат".
  - /pattern-test/results/:id
  - Можно открыть позже, из письма, из Telegram и т.д.

## Прохождение теста через Telegram-бота
  - Пользователь проходит тестовый сценарий в чате Telegram-бота.
  - После завершения теста бот отправляет ответы на сервер, сервер сохраняет их и возвращает тот же уникальный id.
  - Бот присылает пользователю ссылку вида:
    https://ai4g.ru/pattern-test/results/:id
  - Пользователь открывает ссылку и видит результат в том же интерфейсе, что и сайт.


  Можно анализировать трафик/статистику отдельно по источнику (сайт / бот) — если добавишь метку в userData: source: "web" или "telegram".