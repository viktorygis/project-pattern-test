{"ast":null,"code":"import*as pdfMake from\"pdfmake/build/pdfmake\";import*as pdfFonts from\"pdfmake/build/vfs_fonts\";import logoBase64 from\"./logo\";import{pdfIntroBlock}from\"./pdfIntroBlock\";import{pdfDominantPatternsBlock}from\"./pdfDominantPatternsBlock\";import{pdfCategoryPatternsBlock}from\"./pdfCategoryPatternsBlock\";import{pdfContactsBlock,pdfRepeatTestBlock,pdfAuthorBlock,pdfDominantPatternsDescriptionsBlock}from\"./pdfContactsBlock\";import{getPatternPercentsByCategory}from\"../../utils/resultsHelpers\";import pdfmakeStyles from\"./pdfmakeStyles\";pdfMake.vfs=pdfFonts.vfs;function isTelegramWebView(){return /Telegram/i.test(navigator.userAgent);}export function downloadPDF(resultsData){if(!resultsData){alert(\"Нет данных для создания PDF!\");return;}const dominantPatternResults=getPatternPercentsByCategory(resultsData.categories,resultsData.patternResults);const docDefinition={content:[...pdfIntroBlock(resultsData,logoBase64),...pdfDominantPatternsBlock(resultsData.categories,dominantPatternResults),...pdfCategoryPatternsBlock(resultsData.categories,resultsData.patternResults),...pdfContactsBlock(),...pdfRepeatTestBlock(),...pdfAuthorBlock(),...pdfDominantPatternsDescriptionsBlock(resultsData.categories,dominantPatternResults)],styles:pdfmakeStyles,footer:(currentPage,pageCount)=>({text:`Страница ${currentPage} из ${pageCount}`,alignment:\"center\",margin:[0,10],style:\"pages\"}),pageMargins:[40,60,40,60]};if(isTelegramWebView()){alert(\"В браузере Telegram автоматическая загрузка PDF не поддерживается.\\nPDF откроется в новом окне — сохраните его вручную через меню браузера.\");pdfMake.createPdf(docDefinition).open();}else{pdfMake.createPdf(docDefinition).download(\"results.pdf\");}}// <-- ВАЖНО: это снаружи функций -->\nif(typeof window!=='undefined'){window.generateDocDefinition=resultsData=>{const dominantPatternResults=getPatternPercentsByCategory(resultsData.categories,resultsData.patternResults);return{content:[...pdfIntroBlock(resultsData,logoBase64),...pdfDominantPatternsBlock(resultsData.categories,dominantPatternResults),...pdfCategoryPatternsBlock(resultsData.categories,resultsData.patternResults),...pdfContactsBlock(),...pdfRepeatTestBlock(),...pdfAuthorBlock(),...pdfDominantPatternsDescriptionsBlock(resultsData.categories,dominantPatternResults)],styles:pdfmakeStyles,footer:(currentPage,pageCount)=>({text:`Страница ${currentPage} из ${pageCount}`,alignment:\"center\",margin:[0,10],style:\"pages\"}),pageMargins:[40,80,40,60]};};}","map":{"version":3,"names":["pdfMake","pdfFonts","logoBase64","pdfIntroBlock","pdfDominantPatternsBlock","pdfCategoryPatternsBlock","pdfContactsBlock","pdfRepeatTestBlock","pdfAuthorBlock","pdfDominantPatternsDescriptionsBlock","getPatternPercentsByCategory","pdfmakeStyles","vfs","isTelegramWebView","test","navigator","userAgent","downloadPDF","resultsData","alert","dominantPatternResults","categories","patternResults","docDefinition","content","styles","footer","currentPage","pageCount","text","alignment","margin","style","pageMargins","createPdf","open","download","window","generateDocDefinition"],"sources":["F:/web/ЗАКАЗЫ/АЙФОРДЖИ/project-pattern-test/project-root/frontend/src/utils/pdf/pdfmakeGenerator.js"],"sourcesContent":["import * as pdfMake from \"pdfmake/build/pdfmake\";\r\nimport * as pdfFonts from \"pdfmake/build/vfs_fonts\";\r\nimport logoBase64 from \"./logo\";\r\nimport { pdfIntroBlock } from \"./pdfIntroBlock\";\r\nimport { pdfDominantPatternsBlock } from \"./pdfDominantPatternsBlock\";\r\nimport { pdfCategoryPatternsBlock } from \"./pdfCategoryPatternsBlock\";\r\nimport { pdfContactsBlock, pdfRepeatTestBlock, pdfAuthorBlock, pdfDominantPatternsDescriptionsBlock } from \"./pdfContactsBlock\";\r\nimport { getPatternPercentsByCategory } from \"../../utils/resultsHelpers\";\r\nimport pdfmakeStyles from \"./pdfmakeStyles\";\r\n\r\npdfMake.vfs = pdfFonts.vfs;\r\n\r\nfunction isTelegramWebView() {\r\n  return /Telegram/i.test(navigator.userAgent);\r\n}\r\n\r\nexport function downloadPDF(resultsData) {\r\n  if (!resultsData) {\r\n    alert(\"Нет данных для создания PDF!\");\r\n    return;\r\n  }\r\n\r\n  const dominantPatternResults = getPatternPercentsByCategory(\r\n    resultsData.categories,\r\n    resultsData.patternResults\r\n  );\r\n\r\n  const docDefinition = {\r\n    content: [\r\n      ...pdfIntroBlock(resultsData, logoBase64),\r\n      ...pdfDominantPatternsBlock(resultsData.categories, dominantPatternResults),\r\n      ...pdfCategoryPatternsBlock(resultsData.categories, resultsData.patternResults),\r\n      ...pdfContactsBlock(),\r\n      ...pdfRepeatTestBlock(),\r\n      ...pdfAuthorBlock(),\r\n      ...pdfDominantPatternsDescriptionsBlock(resultsData.categories, dominantPatternResults),\r\n    ],\r\n    styles: pdfmakeStyles,\r\n    footer: (currentPage, pageCount) => ({\r\n      text: `Страница ${currentPage} из ${pageCount}`,\r\n      alignment: \"center\",\r\n      margin: [0, 10],\r\n      style: \"pages\",\r\n    }),\r\n    pageMargins: [40, 60, 40, 60],\r\n  };\r\n\r\n  if (isTelegramWebView()) {\r\n    alert(\"В браузере Telegram автоматическая загрузка PDF не поддерживается.\\nPDF откроется в новом окне — сохраните его вручную через меню браузера.\");\r\n    pdfMake.createPdf(docDefinition).open();\r\n  } else {\r\n    pdfMake.createPdf(docDefinition).download(\"results.pdf\");\r\n  }\r\n}\r\n\r\n// <-- ВАЖНО: это снаружи функций -->\r\nif (typeof window !== 'undefined') {\r\n  window.generateDocDefinition = (resultsData) => {\r\n    const dominantPatternResults = getPatternPercentsByCategory(\r\n      resultsData.categories,\r\n      resultsData.patternResults\r\n    );\r\n\r\n    return {\r\n      content: [\r\n        ...pdfIntroBlock(resultsData, logoBase64),\r\n        ...pdfDominantPatternsBlock(resultsData.categories, dominantPatternResults),\r\n        ...pdfCategoryPatternsBlock(resultsData.categories, resultsData.patternResults),\r\n        ...pdfContactsBlock(),\r\n        ...pdfRepeatTestBlock(),\r\n        ...pdfAuthorBlock(),\r\n        ...pdfDominantPatternsDescriptionsBlock(resultsData.categories, dominantPatternResults),\r\n      ],\r\n      styles: pdfmakeStyles,\r\n      footer: (currentPage, pageCount) => ({\r\n        text: `Страница ${currentPage} из ${pageCount}`,\r\n        alignment: \"center\",\r\n        margin: [0, 10],\r\n        style: \"pages\",\r\n      }),\r\n      pageMargins: [40, 80, 40, 60],\r\n    };\r\n  };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}