{"ast":null,"code":"//PatternTestResultPage.jsx\nimport React,{useEffect,useState,useMemo}from\"react\";import{useParams}from\"react-router-dom\";import ResultsScreen from\"../Screens/ResultsScreen\";import{createResultsData,getTopPatterns,getTopCategory,getPatternMessage,getOpportunities,getBehaviorModel,getStrengths}from\"../../utils/resultsHelpers\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function PatternTestResultPage(){const{id}=useParams();const[resultData,setResultData]=useState(null);const[categories,setCategories]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(false);useEffect(()=>{fetch(process.env.PUBLIC_URL+\"/data/patterns.json\").then(res=>res.json()).then(data=>setCategories(Array.isArray(data.categories)?data.categories:[])).catch(()=>setCategories([]));},[]);useEffect(()=>{if(!id)return;setLoading(true);setError(false);setResultData(null);const localData=localStorage.getItem(`test-result-${id}`);if(localData){setResultData(JSON.parse(localData));setError(false);setLoading(false);return;}fetch(`/api/results/${id}`).then(response=>{if(!response.ok)throw new Error(\"No result\");return response.json();}).then(data=>{setResultData(data);setError(false);}).catch(()=>{setError(true);}).finally(()=>{setLoading(false);});},[id]);useEffect(()=>{if(error&&categories.length&&!resultData){setResultData({user:{fullName:\"Иван Иванов\",phone:\"+79998887766\",telegram:\"@ivanov\",email:\"ivan@example.com\"},answers:Array(60).fill(\"Изобилие времени\"),patterns:Array(60).fill(\"Изобилие времени\")});}},[error,categories,resultData]);// Массив паттернов\nconst patternResultsStrings=useMemo(()=>{if(Array.isArray(resultData===null||resultData===void 0?void 0:resultData.patterns)){return resultData.patterns.map(a=>typeof a===\"string\"?a:a.pattern||\"\");}// fallback: если patterns нет, используем answers (старые результаты)\nif(Array.isArray(resultData===null||resultData===void 0?void 0:resultData.answers)){return resultData.answers.map(a=>typeof a===\"string\"?a:a.pattern||\"\");}return[];},[resultData]);const resultsData=useMemo(()=>{if(!resultData||!categories.length)return null;return createResultsData({userData:resultData.user,categories,patternResults:patternResultsStrings});},[resultData,categories,patternResultsStrings]);const topPatterns=useMemo(()=>resultsData?getTopPatterns(resultsData):[],[resultsData]);const topCategory=useMemo(()=>resultsData?getTopCategory(resultsData):null,[resultsData]);const patternMessage=useMemo(()=>resultsData?getPatternMessage(resultsData):\"\",[resultsData]);const opportunities=useMemo(()=>resultsData?getOpportunities(resultsData):\"\",[resultsData]);const behaviorModel=useMemo(()=>resultsData?getBehaviorModel(resultsData):\"\",[resultsData]);const strengths=useMemo(()=>resultsData?getStrengths(resultsData):\"\",[resultsData]);if(loading||!categories.length||!resultsData){return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"});}return/*#__PURE__*/_jsx(ResultsScreen,{resultsData:resultsData,answers:resultData.answers,patterns:patternResultsStrings,categories:categories,patternResults:resultsData.patternResults,topPatterns:topPatterns,topCategory:topCategory,patternMessage:patternMessage,opportunities:opportunities,behaviorModel:behaviorModel,strengths:strengths});}","map":{"version":3,"names":["React","useEffect","useState","useMemo","useParams","ResultsScreen","createResultsData","getTopPatterns","getTopCategory","getPatternMessage","getOpportunities","getBehaviorModel","getStrengths","jsx","_jsx","PatternTestResultPage","id","resultData","setResultData","categories","setCategories","loading","setLoading","error","setError","fetch","process","env","PUBLIC_URL","then","res","json","data","Array","isArray","catch","localData","localStorage","getItem","JSON","parse","response","ok","Error","finally","length","user","fullName","phone","telegram","email","answers","fill","patterns","patternResultsStrings","map","a","pattern","resultsData","userData","patternResults","topPatterns","topCategory","patternMessage","opportunities","behaviorModel","strengths","children"],"sources":["F:/web/ЗАКАЗЫ/АЙФОРДЖИ/project-pattern-test/project-root/frontend/src/components/pages/PatternTestResultPage.jsx"],"sourcesContent":["\r\n//PatternTestResultPage.jsx\r\nimport React, { useEffect, useState, useMemo } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport ResultsScreen from \"../Screens/ResultsScreen\";\r\nimport {\r\n  createResultsData,\r\n  getTopPatterns,\r\n  getTopCategory,\r\n  getPatternMessage,\r\n  getOpportunities,\r\n  getBehaviorModel,\r\n  getStrengths\r\n} from \"../../utils/resultsHelpers\";\r\n\r\nexport default function PatternTestResultPage() {\r\n  const { id } = useParams();\r\n  const [resultData, setResultData] = useState(null);\r\n  const [categories, setCategories] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetch(process.env.PUBLIC_URL + \"/data/patterns.json\")\r\n      .then(res => res.json())\r\n      .then(data => setCategories(Array.isArray(data.categories) ? data.categories : []))\r\n      .catch(() => setCategories([]));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!id) return;\r\n    setLoading(true);\r\n    setError(false);\r\n    setResultData(null);\r\n\r\n    const localData = localStorage.getItem(`test-result-${id}`);\r\n    if (localData) {\r\n      setResultData(JSON.parse(localData));\r\n      setError(false);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    fetch(`/api/results/${id}`)\r\n      .then(response => {\r\n        if (!response.ok) throw new Error(\"No result\");\r\n        return response.json();\r\n      })\r\n      .then(data => {\r\n        setResultData(data);\r\n        setError(false);\r\n      })\r\n      .catch(() => {\r\n        setError(true);\r\n      })\r\n      .finally(() => {\r\n        setLoading(false);\r\n      });\r\n  }, [id]);\r\n\r\n  useEffect(() => {\r\n    if (error && categories.length && !resultData) {\r\n      setResultData({\r\n        user: {\r\n          fullName: \"Иван Иванов\",\r\n          phone: \"+79998887766\",\r\n          telegram: \"@ivanov\",\r\n          email: \"ivan@example.com\"\r\n        },\r\n        answers: Array(60).fill(\"Изобилие времени\"),\r\n        patterns: Array(60).fill(\"Изобилие времени\")\r\n      });\r\n    }\r\n  }, [error, categories, resultData]);\r\n\r\n  // Массив паттернов\r\n  const patternResultsStrings = useMemo(() => {\r\n    if (Array.isArray(resultData?.patterns)) {\r\n      return resultData.patterns.map(\r\n        a => typeof a === \"string\" ? a : (a.pattern || \"\")\r\n      );\r\n    }\r\n    // fallback: если patterns нет, используем answers (старые результаты)\r\n    if (Array.isArray(resultData?.answers)) {\r\n      return resultData.answers.map(\r\n        a => typeof a === \"string\" ? a : (a.pattern || \"\")\r\n      );\r\n    }\r\n    return [];\r\n  }, [resultData]);\r\n\r\n  const resultsData = useMemo(() => {\r\n    if (!resultData || !categories.length) return null;\r\n    return createResultsData({\r\n      userData: resultData.user,\r\n      categories,\r\n      patternResults: patternResultsStrings\r\n    });\r\n  }, [resultData, categories, patternResultsStrings]);\r\n\r\n  const topPatterns = useMemo(() => resultsData ? getTopPatterns(resultsData) : [], [resultsData]);\r\n  const topCategory = useMemo(() => resultsData ? getTopCategory(resultsData) : null, [resultsData]);\r\n  const patternMessage = useMemo(() => resultsData ? getPatternMessage(resultsData) : \"\", [resultsData]);\r\n  const opportunities = useMemo(() => resultsData ? getOpportunities(resultsData) : \"\", [resultsData]);\r\n  const behaviorModel = useMemo(() => resultsData ? getBehaviorModel(resultsData) : \"\", [resultsData]);\r\n  const strengths = useMemo(() => resultsData ? getStrengths(resultsData) : \"\", [resultsData]);\r\n\r\n  if (loading || !categories.length || !resultsData) {\r\n    return <div>Загрузка...</div>;\r\n  }\r\n\r\n  return (\r\n    <ResultsScreen\r\n      resultsData={resultsData}\r\n      answers={resultData.answers}\r\n      patterns={patternResultsStrings}\r\n      categories={categories}\r\n      patternResults={resultsData.patternResults}\r\n      topPatterns={topPatterns}\r\n      topCategory={topCategory}\r\n      patternMessage={patternMessage}\r\n      opportunities={opportunities}\r\n      behaviorModel={behaviorModel}\r\n      strengths={strengths}\r\n    />\r\n  );\r\n}"],"mappings":"AACA;AACA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,CAAEC,OAAO,KAAQ,OAAO,CAC3D,OAASC,SAAS,KAAQ,kBAAkB,CAC5C,MAAO,CAAAC,aAAa,KAAM,0BAA0B,CACpD,OACEC,iBAAiB,CACjBC,cAAc,CACdC,cAAc,CACdC,iBAAiB,CACjBC,gBAAgB,CAChBC,gBAAgB,CAChBC,YAAY,KACP,4BAA4B,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEpC,cAAe,SAAS,CAAAC,qBAAqBA,CAAA,CAAG,CAC9C,KAAM,CAAEC,EAAG,CAAC,CAAGZ,SAAS,CAAC,CAAC,CAC1B,KAAM,CAACa,UAAU,CAAEC,aAAa,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAClD,KAAM,CAACiB,UAAU,CAAEC,aAAa,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACmB,OAAO,CAAEC,UAAU,CAAC,CAAGpB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACqB,KAAK,CAAEC,QAAQ,CAAC,CAAGtB,QAAQ,CAAC,KAAK,CAAC,CAEzCD,SAAS,CAAC,IAAM,CACdwB,KAAK,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAAG,qBAAqB,CAAC,CAClDC,IAAI,CAACC,GAAG,EAAIA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CACvBF,IAAI,CAACG,IAAI,EAAIZ,aAAa,CAACa,KAAK,CAACC,OAAO,CAACF,IAAI,CAACb,UAAU,CAAC,CAAGa,IAAI,CAACb,UAAU,CAAG,EAAE,CAAC,CAAC,CAClFgB,KAAK,CAAC,IAAMf,aAAa,CAAC,EAAE,CAAC,CAAC,CACnC,CAAC,CAAE,EAAE,CAAC,CAENnB,SAAS,CAAC,IAAM,CACd,GAAI,CAACe,EAAE,CAAE,OACTM,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAAC,KAAK,CAAC,CACfN,aAAa,CAAC,IAAI,CAAC,CAEnB,KAAM,CAAAkB,SAAS,CAAGC,YAAY,CAACC,OAAO,CAAC,eAAetB,EAAE,EAAE,CAAC,CAC3D,GAAIoB,SAAS,CAAE,CACblB,aAAa,CAACqB,IAAI,CAACC,KAAK,CAACJ,SAAS,CAAC,CAAC,CACpCZ,QAAQ,CAAC,KAAK,CAAC,CACfF,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CAEAG,KAAK,CAAC,gBAAgBT,EAAE,EAAE,CAAC,CACxBa,IAAI,CAACY,QAAQ,EAAI,CAChB,GAAI,CAACA,QAAQ,CAACC,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,CAAC,WAAW,CAAC,CAC9C,MAAO,CAAAF,QAAQ,CAACV,IAAI,CAAC,CAAC,CACxB,CAAC,CAAC,CACDF,IAAI,CAACG,IAAI,EAAI,CACZd,aAAa,CAACc,IAAI,CAAC,CACnBR,QAAQ,CAAC,KAAK,CAAC,CACjB,CAAC,CAAC,CACDW,KAAK,CAAC,IAAM,CACXX,QAAQ,CAAC,IAAI,CAAC,CAChB,CAAC,CAAC,CACDoB,OAAO,CAAC,IAAM,CACbtB,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAC,CACN,CAAC,CAAE,CAACN,EAAE,CAAC,CAAC,CAERf,SAAS,CAAC,IAAM,CACd,GAAIsB,KAAK,EAAIJ,UAAU,CAAC0B,MAAM,EAAI,CAAC5B,UAAU,CAAE,CAC7CC,aAAa,CAAC,CACZ4B,IAAI,CAAE,CACJC,QAAQ,CAAE,aAAa,CACvBC,KAAK,CAAE,cAAc,CACrBC,QAAQ,CAAE,SAAS,CACnBC,KAAK,CAAE,kBACT,CAAC,CACDC,OAAO,CAAElB,KAAK,CAAC,EAAE,CAAC,CAACmB,IAAI,CAAC,kBAAkB,CAAC,CAC3CC,QAAQ,CAAEpB,KAAK,CAAC,EAAE,CAAC,CAACmB,IAAI,CAAC,kBAAkB,CAC7C,CAAC,CAAC,CACJ,CACF,CAAC,CAAE,CAAC7B,KAAK,CAAEJ,UAAU,CAAEF,UAAU,CAAC,CAAC,CAEnC;AACA,KAAM,CAAAqC,qBAAqB,CAAGnD,OAAO,CAAC,IAAM,CAC1C,GAAI8B,KAAK,CAACC,OAAO,CAACjB,UAAU,SAAVA,UAAU,iBAAVA,UAAU,CAAEoC,QAAQ,CAAC,CAAE,CACvC,MAAO,CAAApC,UAAU,CAACoC,QAAQ,CAACE,GAAG,CAC5BC,CAAC,EAAI,MAAO,CAAAA,CAAC,GAAK,QAAQ,CAAGA,CAAC,CAAIA,CAAC,CAACC,OAAO,EAAI,EACjD,CAAC,CACH,CACA;AACA,GAAIxB,KAAK,CAACC,OAAO,CAACjB,UAAU,SAAVA,UAAU,iBAAVA,UAAU,CAAEkC,OAAO,CAAC,CAAE,CACtC,MAAO,CAAAlC,UAAU,CAACkC,OAAO,CAACI,GAAG,CAC3BC,CAAC,EAAI,MAAO,CAAAA,CAAC,GAAK,QAAQ,CAAGA,CAAC,CAAIA,CAAC,CAACC,OAAO,EAAI,EACjD,CAAC,CACH,CACA,MAAO,EAAE,CACX,CAAC,CAAE,CAACxC,UAAU,CAAC,CAAC,CAEhB,KAAM,CAAAyC,WAAW,CAAGvD,OAAO,CAAC,IAAM,CAChC,GAAI,CAACc,UAAU,EAAI,CAACE,UAAU,CAAC0B,MAAM,CAAE,MAAO,KAAI,CAClD,MAAO,CAAAvC,iBAAiB,CAAC,CACvBqD,QAAQ,CAAE1C,UAAU,CAAC6B,IAAI,CACzB3B,UAAU,CACVyC,cAAc,CAAEN,qBAClB,CAAC,CAAC,CACJ,CAAC,CAAE,CAACrC,UAAU,CAAEE,UAAU,CAAEmC,qBAAqB,CAAC,CAAC,CAEnD,KAAM,CAAAO,WAAW,CAAG1D,OAAO,CAAC,IAAMuD,WAAW,CAAGnD,cAAc,CAACmD,WAAW,CAAC,CAAG,EAAE,CAAE,CAACA,WAAW,CAAC,CAAC,CAChG,KAAM,CAAAI,WAAW,CAAG3D,OAAO,CAAC,IAAMuD,WAAW,CAAGlD,cAAc,CAACkD,WAAW,CAAC,CAAG,IAAI,CAAE,CAACA,WAAW,CAAC,CAAC,CAClG,KAAM,CAAAK,cAAc,CAAG5D,OAAO,CAAC,IAAMuD,WAAW,CAAGjD,iBAAiB,CAACiD,WAAW,CAAC,CAAG,EAAE,CAAE,CAACA,WAAW,CAAC,CAAC,CACtG,KAAM,CAAAM,aAAa,CAAG7D,OAAO,CAAC,IAAMuD,WAAW,CAAGhD,gBAAgB,CAACgD,WAAW,CAAC,CAAG,EAAE,CAAE,CAACA,WAAW,CAAC,CAAC,CACpG,KAAM,CAAAO,aAAa,CAAG9D,OAAO,CAAC,IAAMuD,WAAW,CAAG/C,gBAAgB,CAAC+C,WAAW,CAAC,CAAG,EAAE,CAAE,CAACA,WAAW,CAAC,CAAC,CACpG,KAAM,CAAAQ,SAAS,CAAG/D,OAAO,CAAC,IAAMuD,WAAW,CAAG9C,YAAY,CAAC8C,WAAW,CAAC,CAAG,EAAE,CAAE,CAACA,WAAW,CAAC,CAAC,CAE5F,GAAIrC,OAAO,EAAI,CAACF,UAAU,CAAC0B,MAAM,EAAI,CAACa,WAAW,CAAE,CACjD,mBAAO5C,IAAA,QAAAqD,QAAA,CAAK,qDAAW,CAAK,CAAC,CAC/B,CAEA,mBACErD,IAAA,CAACT,aAAa,EACZqD,WAAW,CAAEA,WAAY,CACzBP,OAAO,CAAElC,UAAU,CAACkC,OAAQ,CAC5BE,QAAQ,CAAEC,qBAAsB,CAChCnC,UAAU,CAAEA,UAAW,CACvByC,cAAc,CAAEF,WAAW,CAACE,cAAe,CAC3CC,WAAW,CAAEA,WAAY,CACzBC,WAAW,CAAEA,WAAY,CACzBC,cAAc,CAAEA,cAAe,CAC/BC,aAAa,CAAEA,aAAc,CAC7BC,aAAa,CAAEA,aAAc,CAC7BC,SAAS,CAAEA,SAAU,CACtB,CAAC,CAEN","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}