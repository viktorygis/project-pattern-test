// Словарь соответствия паттернов типу реагирования
// Ключ - паттерн (ru, нижний регистр), значение - тип реагирования
export const patternToResponseType = {
	// Ориентация во времени
	"дефицит времени": "Моноактивный",
	будущее: "Моноактивный",
	монохронность: "Моноактивный",
	"долгосрочная мотивация": "Моноактивный",

	настоящее: "Мультиактивный",
	полихронность: "Мультиактивный",
	"краткосрочная мотивация": "Мультиактивный",

	"изобилие времени": "Реактивный",
	прошлое: "Реактивный",

	// Поведение
	делать: "Моноактивный",
	конкуренция: "Моноактивный",
	"защищать границы": "Моноактивный",
	контроль: "Моноактивный",

	изменения: "Мультиактивный",
	сотрудничество: "Мультиактивный",
	"делиться ресурсами": "Мультиактивный",

	быть: "Реактивный",
	стабильность: "Реактивный",
	сотрудничество: "Реактивный",
	"защищать границы": "Реактивный",

	// Мышление
	"дедуктивное мышление": "Моноактивный",
	"аналитичное мышление": "Моноактивный",
	"системное мышление": "Моноактивный",
	/* 	процедурность: "Моноактивный", */

	"аналитичное мышление": "Мультиактивный",
	полезависимость: "Мультиактивный",
	импульсивность: "Мультиактивный",

	"индуктивное мышление": "Реактивный",
	рефлексивность: "Реактивный",

	// Коммуникация
	"низкий контекст": "Моноактивный",
	"прямая коммуникация": "Моноактивный",
	"нейтральная коммуникация": "Моноактивный",
	"формальная коммуникация": "Моноактивный",
	/* поленезависимость- случайное значение, нет в таблице */
	поленезависимость: "Мультиактивный",
	"высокий контекст": "Мультиактивный",
	"прямая коммуникация": "Мультиактивный",
	"эмоциональная коммуникация": "Мультиактивный",
	"неформальная коммуникация": "Мультиактивный",

	"низкий контекст": "Реактивный",
	"непрямая коммуникация": "Реактивный",
	"нейтральная коммуникация": "Реактивный",

	// Мотивация
	контроль: "Моноактивный",

	интерес: "Мультиактивный",
	изменения: "Мультиактивный",

	гармония: "Реактивный",
	"принятие реальности": "Реактивный",

	// Социальность
	индивидуализм: "Моноактивный",
	ответственность: "Моноактивный",
	конкуренция: "Моноактивный",

	сотрудничество: "Мультиактивный",

	коллективизм: "Реактивный",
	сотрудничество: "Реактивный",
};

// Универсальный алгоритм для определения типа реагирования
export function determineResponseType(userPatterns) {
	const counter = {
		Моноактивный: 0,
		Мультиактивный: 0,
		Реактивный: 0,
	};

	const unknownPatterns = [];

	userPatterns.forEach((pattern) => {
		const key = (pattern || "").trim().toLowerCase();
		const type = patternToResponseType[key];
		if (type) {
			counter[type]++;
		} else {
			unknownPatterns.push(key);
		}
	});

	// Логируем паттерны, которых нет в словаре
	if (unknownPatterns.length) {
		console.warn("Паттерны, отсутствующие в словаре patternToResponseType:", unknownPatterns);
	}

	const max = Math.max(...Object.values(counter));
	const topTypes = Object.entries(counter)
		.filter(([_, count]) => count === max && count > 0)
		.map(([type]) => type);

	return topTypes.length === 1 ? topTypes[0] : max === 0 ? "Не определён" : "Смешанный";
}
